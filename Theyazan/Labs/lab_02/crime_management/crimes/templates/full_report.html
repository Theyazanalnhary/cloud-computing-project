{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-5">
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h2 class="text-center">التقرير الكامل للجريمة</h2>
        </div>
    </div>

    <!-- تفاصيل الجريمة الأساسية -->
    <div class="card mb-4">
        <div class="card-header bg-secondary text-white">
            <h4>تفاصيل البلاغ</h4>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <p><strong>رقم البلاغ:</strong> {{ crime.report_number }}</p>
                    <p><strong>تاريخ البلاغ:</strong> {{ crime.report_date }}</p>
                    <p><strong>اسم المبلغ:</strong> {{ crime.reporter_name }}</p>
                    <p><strong>هاتف المبلغ:</strong> {{ crime.reporter_phone }}</p>
                </div>
                <div class="col-md-6">
                    <p><strong>نوع الجريمة:</strong> {{ crime.crime_type }}</p>
                    <p><strong>تاريخ الجريمة:</strong> {{ crime.crime_date }}</p>
                    <p><strong>وقت الجريمة:</strong> {{ crime.crime_time }}</p>
                    <p><strong>مكان الجريمة:</strong> {{ crime.location }}</p>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-12">
                    <p><strong>وصف الجريمة:</strong></p>
                    <p>{{ crime.description }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- قائمة المجني عليهم -->
    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <h4>المجني عليهم</h4>
        </div>
        <div class="card-body">
            {% if victims %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>الاسم</th>
                            <th>العمر</th>
                            <th>الجنس</th>
                            <th>الجنسية</th>
                            <th>رقم الهاتف</th>
                            <th>المهنة</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for victim in victims %}
                        <tr>
                            <td>{{ victim.full_name }}</td>
                            <td>{{ victim.age }}</td>
                            <td>{{ victim.gender }}</td>
                            <td>{{ victim.nationality }}</td>
                            <td>{{ victim.phone }}</td>
                            <td>{{ victim.job }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted">لا يوجد مجني عليهم مسجلين لهذه الجريمة</p>
            {% endif %}
        </div>
    </div>

    <!-- قائمة المتهمين -->
    <div class="card mb-4">
        <div class="card-header bg-warning text-dark">
            <h4>المتهمون</h4>
        </div>
        <div class="card-body">
            {% if suspects %}
            <div class="table-responsive">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>الاسم</th>
                            <th>العمر</th>
                            <th>الجنس</th>
                            <th>الجنسية</th>
                            <th>رقم الهاتف</th>
                            <th>دور في الجريمة</th>
                            <th>حالة</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for suspect in suspects %}
                        <tr>
                            <td>{{ suspect.full_name }}</td>
                            <td>{{ suspect.age }}</td>
                            <td>{{ suspect.gender }}</td>
                            <td>{{ suspect.nationality }}</td>
                            <td>{{ suspect.phone }}</td>
                            <td>{{ suspect.role_in_crime }}</td>
                            <td>
                                {% if suspect.is_fugitive %}
                                <span class="badge bg-danger">هارب</span>
                                {% else %}
                                <span class="badge bg-success">مقبوض عليه</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted">لا يوجد متهمون مسجلون لهذه الجريمة</p>
            {% endif %}
        </div>
    </div>

    <!-- الأضرار الناتجة -->
    <div class="card mb-4">
        <div class="card-header bg-danger text-white">
            <h4>الأضرار الناتجة</h4>
        </div>
        <div class="card-body">
            {% if damages %}
            <div class="row">
                {% for damage in damages %}
                <div class="col-md-6 mb-3">
                    <div class="card">
                        <div class="card-header">
                            <h5>نوع الضرر: {{ damage.damage_type }}</h5>
                        </div>
                        <div class="card-body">
                            {% if damage.damage_type == 'بشري' %}
                            <p><strong>وفيات ذكور:</strong> {{ damage.male_deaths|default:"0" }}</p>
                            <p><strong>وفيات إناث:</strong> {{ damage.female_deaths|default:"0" }}</p>
                            <p><strong>إصابات ذكور:</strong> {{ damage.male_injuries|default:"0" }}</p>
                            <p><strong>إصابات إناث:</strong> {{ damage.female_injuries|default:"0" }}</p>
                            {% else %}
                            <p><strong>وصف الضرر المادي:</strong></p>
                            <p>{{ damage.material_damage_description }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-muted">لا يوجد أضرار مسجلة لهذه الجريمة</p>
            {% endif %}
        </div>
    </div>

    <!-- إجراءات التحري -->
    <div class="card mb-4">
        <div class="card-header bg-dark text-white">
            <h4>إجراءات التحري</h4>
        </div>
        <div class="card-body">
            {% if investigations %}
            <div class="accordion" id="investigationsAccordion">
                {% for investigation in investigations %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                data-bs-target="#collapse{{ forloop.counter }}" aria-expanded="false" 
                                aria-controls="collapse{{ forloop.counter }}">
                            إجراء التحري رقم: {{ investigation.investigation_id }} - المتهم: {{ investigation.suspect.full_name }}
                        </button>
                    </h2>
                    <div id="collapse{{ forloop.counter }}" class="accordion-collapse collapse" 
                         aria-labelledby="heading{{ forloop.counter }}" data-bs-parent="#investigationsAccordion">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>وضعية الجاني:</strong> {{ investigation.status }}</p>
                                    <p><strong>تاريخ القبض:</strong> {{ investigation.arrest_date|default:"-" }}</p>
                                    <p><strong>كيفية القبض:</strong> {{ investigation.arrest_method|default:"-" }}</p>
                                    <p><strong>صفة القابض:</strong> {{ investigation.arresting_officer|default:"-" }}</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>تاريخ التوقيف:</strong> {{ investigation.detention_date|default:"-" }}</p>
                                    <p><strong>تاريخ الإفراج:</strong> {{ investigation.release_date|default:"-" }}</p>
                                    <p><strong>إفراج بضمان:</strong> 
                                        {% if investigation.released_on_bail %} نعم {% else %} لا {% endif %}
                                    </p>
                                    <p><strong>اسم الضامن:</strong> {{ investigation.bail_guarantor|default:"-" }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-muted">لا يوجد إجراءات تحري مسجلة لهذه الجريمة</p>
            {% endif %}
        </div>
    </div>

    <!-- إجراءات النيابة -->
    <div class="card mb-4">
        <div class="card-header bg-success text-white">
            <h4>إجراءات النيابة</h4>
        </div>
        <div class="card-body">
            {% if prosecutions %}
            <div class="accordion" id="prosecutionsAccordion">
                {% for prosecution in prosecutions %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="prosHeading{{ forloop.counter }}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                data-bs-target="#prosCollapse{{ forloop.counter }}" aria-expanded="false" 
                                aria-controls="prosCollapse{{ forloop.counter }}">
                            إجراء النيابة رقم: {{ prosecution.prosecution_id }} - النيابة: {{ prosecution.prosecutor_office }}
                        </button>
                    </h2>
                    <div id="prosCollapse{{ forloop.counter }}" class="accordion-collapse collapse" 
                         aria-labelledby="prosHeading{{ forloop.counter }}" data-bs-parent="#prosecutionsAccordion">
                        <div class="accordion-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>رقم القضية:</strong> {{ prosecution.case_number }}</p>
                                    <p><strong>تاريخ التقديم:</strong> {{ prosecution.submission_date }}</p>
                                    <p><strong>قرارات النيابة:</strong> {{ prosecution.prosecutor_decisions }}</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>تاريخ الإحالة للمحكمة:</strong> {{ prosecution.referral_to_court_date|default:"-" }}</p>
                                    <p><strong>إجراءات المحكمة:</strong> {{ prosecution.court_procedures|default:"-" }}</p>
                                    <p><strong>منطوق الحكم:</strong> {{ prosecution.verdict|default:"-" }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-muted">لا يوجد إجراءات نيابة مسجلة لهذه الجريمة</p>
            {% endif %}
        </div>
    </div>

    <!-- زر الطباعة -->
    <div class="text-center mb-4">
        <button class="btn btn-primary" onclick="window.print()">
            <i class="fas fa-print"></i> طباعة التقرير
        </button>
    </div>
</div>
{% endblock %}